class DragMoveModel{startX=0;startY=0;moveInsX=0;moveInsY=0;isMousedown=!1;targetEl=null;targetElTx=0;targetElTy=0;initTargetElTop=0;initTargetElLeft=0;limitMoveBorder=!1;moveMode="transform";callback=null;h5=!1;disableMoveEl=!1;maxMoveX=1e6;maxMoveY=1e6;rootDom=document;constructor(t={},e=()=>{}){this._initConfig(t),this._initEvent(),this._initTragetElInfo(),this.callback=e}_initConfig(t){this.targetEl=t.targetEl||this.rootDom.body,this.limitMoveBorder=!!t.limitMoveBorder,this.moveMode=t.moveMode||"transform",this.h5=!!t.h5,this.disableMoveEl=!!t.disableMoveEl,this.maxMoveX=t.maxMoveX||this.maxMoveX,this.maxMoveY=t.maxMoveY||this.maxMoveY}_initTragetElInfo(){var t,e;this.targetEl&&({top:t,left:e}=this.targetEl.getBoundingClientRect(),this.initTargetElTop=t,this.initTargetElLeft=e,this.targetEl.style["will-change"]="transform"===this.moveMode?"transform":"left, top")}_getStyleTransformProp(t="",e="scale"){t=(t=t.replaceAll(", ",",").trim()).split(" ");let i="";return t.forEach(t=>{t.includes(e)&&(i=t)}),i}_calcTargetTranlate=()=>{if(this.targetEl){let t=this._getStyleTransformProp(this.targetEl.style.transform,"translate3d");var e;t.includes("translate3d")&&(e=/\((.*)\)/g.exec(t),e=(t=e?e[1].replaceAll(", ",","):t).replace("(","").replace(")","").split(","),this.targetElTx=+e[0].replace("px","")||0,this.targetElTy=+e[1].replace("px","")||0)}};_setTransformProp(t="",e="",i=""){let s=new RegExp(e+"((.*))","g");return t=t.includes(e)?t.replaceAll(", ",",").trim().split(" ").map(t=>t.replaceAll(s,e+`(${i})`)).join(" "):e+`(${i}) `+t}_translateMoveEl(){if(this.targetEl){let t=this.targetElTx+this.moveInsX,e=this.targetElTy+this.moveInsY;if(this.limitMoveBorder){var{width:i,height:s}=this.targetEl.getBoundingClientRect();(t=t+i+this.initTargetElLeft>window.innerWidth?window.innerWidth-i-this.initTargetElLeft:t)<-this.initTargetElLeft&&(t=-this.initTargetElLeft),(e=e+s+this.initTargetElTop>window.innerHeight?window.innerHeight-s-this.initTargetElTop:e)<-this.initTargetElTop&&(e=-this.initTargetElTop)}i=(i=this.targetEl.style.transform)?this._setTransformProp(i,"translate3d",`${t}px, ${e}px, 0px`):`translate3d(${t}px, ${e}px, 0px)`;this.targetEl.style.transform=i}}_topLeftMoveTargetEl=()=>{let t=this.moveInsX+this.initTargetElLeft,e=this.moveInsY+this.initTargetElTop;{var i,s;this.limitMoveBorder&&({width:i,height:s}=this.targetEl.getBoundingClientRect(),(e=e<0?0:e)>window.innerHeight-s&&(e=window.innerHeight-s),(t=t<0?0:t)>window.innerWidth-i)&&(t=window.innerWidth-i)}this.targetEl.style.left=t+"px",this.targetEl.style.top=e+"px"};_mousemoveHandler=t=>{var e=(this.h5?t.changedTouches[0]:t).pageX,t=(this.h5?t.changedTouches[0]:t).pageY;this.isMousedown&&(e<this.startX&&(this.moveInsX=this.moveInsX>-this.maxMoveX?e-this.startX:-this.maxMoveX),e>this.startX&&(this.moveInsX=this.moveInsX<this.maxMoveX?e-this.startX:this.maxMoveX),t<this.startY&&(this.moveInsY=this.moveInsY>-this.maxMoveY?t-this.startY:-this.maxMoveY),t>this.startY&&(this.moveInsY=this.moveInsY<this.maxMoveY?t-this.startY:this.maxMoveY),this.disableMoveEl||("position"===this.moveMode?this._topLeftMoveTargetEl():this._translateMoveEl()),e=Math.round(Math.pow(this.moveInsX*this.moveInsX+this.moveInsY*this.moveInsY,.5)),this.callback(this.moveInsX,this.moveInsY,e))};_mousedownHandler=t=>{var e=(this.h5?t.changedTouches[0]:t).pageX,t=(this.h5?t.changedTouches[0]:t).pageY;this.startX=e,this.startY=t,this.moveInsX=0,this.moveInsY=0,this.isMousedown=!0,this._calcTargetTranlate(),"position"===this.moveMode&&this._initTragetElInfo()};_mouseupHandler=t=>{this.isMousedown=!1,this.startX=0,this.startY=0};_initEvent(){var t=this.h5?"touchmove":"mousemove",e=this.h5?"touchstart":"mousedown",i=this.h5?"touchend":"mouseup";this.rootDom.addEventListener(t,this._mousemoveHandler),this.targetEl&&this.targetEl.addEventListener(e,this._mousedownHandler),this.rootDom.addEventListener(i,this._mouseupHandler)}destroy(){var t=this.h5?"touchmove":"mousemove",e=this.h5?"touchstart":"mousedown",i=this.h5?"touchend":"mouseup";this.targetEl&&this.targetEl.removeEventListener(t,this._mousedownHandler),this.rootDom.removeEventListener(e,this._mousemoveHandler),this.rootDom.removeEventListener(i,this._mouseupHandler)}}